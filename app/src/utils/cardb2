
import { MongoClient, ObjectId, WithId } from "mongodb";
import mongoose from 'mongoose';
import executeAsync from '@/utils/Result';
import dotenv from 'dotenv';

import vehicle, {ICar} from '@/models/car';


// Load environment variables from .env file
dotenv.config();
// Retrieve the MongoDB URI from environment variables
const uri = process.env.MONGODB_URI as string;


/**
 * Connects to the MongoDB database using Mongoose.
 * This function wraps the connection logic in an asynchronous operation
 * and handles any errors that might occur during the connection process.
 * @returns A promise that resolves when the connection is successful.
 */
export async function connectToDatabase() {
    return executeAsync(async () => {
        console.log('connectted successfullly');
        // Connect to MongoDB with specified options
        await mongoose.connect(uri, {
            serverSelectionTimeoutMS: 5000,
        });
    });
    
}

/**
 * Retrieves all user documents from the database.
 * @returns A promise that resolves with an array of user documents.
 */
export async function getAllUsers() {
    return executeAsync(async () => {
        await connectToDatabase();
        // Query the database for all user documents
        const cars = await vehicle?.find({});
        console.log(cars);
        // Log the result of the query
        return cars;
    });
}